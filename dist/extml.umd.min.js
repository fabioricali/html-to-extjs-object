!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).extml={})}(this,(function(t){"use strict";const e="extml-style-";function s(t,e){if("string"!=typeof t)return;let s=e.replace(/\w/g,"");return t=(t=t.replace(/<\/?style>/g,"").replace(/{/g,"{\n").replace(/}/g,"}\n").replace(/^(\s+)?:(component)(\s+)?{/gm,e+" {").replace(/:(component)/g,"").replace(/(@(?:[\w-]+-)?keyframes\s+)([\w-_]+)/g,`$1 ${s}-$2`).replace(/((?:[\w-]+-)?animation(?:-name)?(?:\s+)?:(?:\s+))([\w-_]+)/g,`$1 ${s}-$2`).replace(/\/\*[\s\S]*?\*\/|([^:]|^)\/\/.*$/gm,"").replace(/\S.*{/gm,(t=>{if(/^(@|:host|(from|to|\d+%)[^-_])/.test(t))return t;let s=t.split(",");const i=new RegExp(`^${e.replace(/[[\]]/g,"\\$&")}(\\s+)?{`);for(let t=0;t<s.length;t++)s[t]=s[t].trim(),i.test(s[t])||(/^:global/.test(s[t])?s[t]=s[t].replace(":global",""):s[t]=`${e} ${s[t]}`);return t=s.join(",")}))).replace(/\s{2,}/g," ").replace(/{ /g,"{").replace(/ }/g,"}").replace(/\s:/g,":").replace(/\n/g,"").trim()}function i(){if(!this.stylesheet)return;let t=this.getId(),i=document.createElement("style");i.id=e+t,this.stylesheetStateListeners=[];let n="";if(this.stylesheet.some((t=>"function"==typeof t&&!0===t.$$isState))){let e=[],r=()=>this.stylesheet.map((t=>"function"==typeof t&&t.$$isState?(e.push(t),t()):t)).join("");n=r(),e.forEach((e=>{this.stylesheetStateListeners.push(e.$$subscribe((e=>{i.innerHTML=s(r(),"#"+t)})))}))}else n=this.stylesheet.join("");i.innerHTML=s(n,"#"+t),document.head.appendChild(i)}function n(){this.stylesheet&&(this.stylesheetStateListeners&&this.stylesheetStateListeners.forEach((t=>t())),document.getElementById(e+this.getId()).remove())}function r(){Ext.getApplication().appContext=Ext.getApplication().appContext||{},this.appContext=Ext.getApplication().appContext;let t=this.getController(),e=this.query?this.query("*"):[];this.contextName&&(void 0!==this.appContext[this.contextName]&&console.error("A context with this name already exists: "+this.contextName,"itemId:",this.getItemId()),this.appContext[this.contextName]={},this.appContext[this.contextName][this.getItemId()]=this,e.forEach((t=>{this.appContext[this.contextName][t.getItemId()]=t,t.appContext=this.appContext}))),this.context||(this.context={},this.context[this.getItemId()]=this,e.forEach((t=>{this.context[t.getItemId()]=t,t.context=this.context}))),t&&(t.appContext=this.appContext,t.context=this.context,t.props=t.view.props)}function o(){Ext.getApplication().appContext=Ext.getApplication().appContext||{},this.contextName&&delete Ext.getApplication().appContext[this.contextName];let t=this.getItemId();Ext.getApplication().appContext[t]&&delete Ext.getApplication().appContext[t]}function a(){i.apply(this),r.apply(this)}function l(){n.apply(this),o.apply(this)}const c=["a","abbr","acronym","address","applet","area","article","aside","audio","b","base","basefont","bdi","bdo","bgsound","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","command","content","data","datalist","dd","del","details","dfn","dialog","dir","div","dl","dt","element","em","embed","fieldset","figcaption","figure","font","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","image","img","input","ins","isindex","kbd","keygen","label","legend","li","link","listing","main","map","mark","marquee","math","menu","menuitem","meta","meter","multicol","nav","nextid","nobr","noembed","noframes","noscript","object","ol","optgroup","option","output","p","param","picture","plaintext","pre","progress","q","rb","rbc","rp","rt","rtc","ruby","s","samp","script","section","select","shadow","slot","small","source","spacer","span","strike","strong","style","sub","summary","sup","svg","table","tbody","td","template","textarea","tfoot","th","thead","time","title","tr","track","tt","u","ul","var","video","wbr","xmp","x-state","x-html","x-for"];function p(t){let e="html-"+t;window.__extHtmlClass[e]=window.Ext.define(e,{extend:"Ext.Container",xtype:e,element:{tag:t,reference:"element"},template:[{tag:"ghost-tag",reference:"bodyElement",cls:"",uiCls:""}],getInnerHtmlElement(){return this.getRenderTarget()},__initializeHackAttempts:0,__initializeHack(t){if(!(this.__initializeHackAttempts>100))return this.el&&this.el.dom?(this.el.dom.className="",this.innerElement.dom.className="",void(this._propsAttributes&&Object.keys(this._propsAttributes).forEach((e=>{if("ref"===e&&this._propsAttributes[e].$$isRef)this._propsAttributes[e](t.el.dom);else if(this._propsAttributes[e].$$isState)this.el.dom.setAttribute(e,String(this._propsAttributes[e]())),t.$$stateListener=this._propsAttributes[e].$$subscribe((t=>{this.el.dom.setAttribute(e,String(t))}));else if(e.startsWith("on")&&"function"==typeof this._propsAttributes[e])this.el.dom.addEventListener(e.substring(2),this._propsAttributes[e]);else if(Array.isArray(this._propsAttributes[e])&&this._propsAttributes[e].$$hasState){let s=()=>this.el.dom.setAttribute(e,this._propsAttributes[e].map((t=>"function"==typeof t&&t.$$isState?t():t)).join(""));s(),t.$$attributesStateListeners=[],this._propsAttributes[e].forEach((e=>{"function"==typeof e&&e.$$isState&&t.$$attributesStateListeners.push(e.$$subscribe((t=>{s()})))}))}else this.el.dom.setAttribute(e,String(this._propsAttributes[e]))})))):(this.__initializeHackAttempts++,void requestAnimationFrame((()=>this.__initializeHack(t))));console.warn("this.el.dom not found")},listeners:[{initialize(t){requestAnimationFrame((()=>this.__initializeHack(t)));let e=this.el.dom.childNodes[1],s=this.el.dom.childNodes[2];e&&e.remove(),s&&s.remove();let i=this.el.dom,n=this.innerElement.dom;if(i&&n){function r(){for(;n.childNodes.length>0;)i.appendChild(n.childNodes[0])}r(),this.innerElement.dom=this.el.dom,n.remove()}}},{destroy(t){t.$$stateListener&&t.$$stateListener(),t.$$attributesStateListeners&&t.$$attributesStateListeners.forEach((t=>t()))}}]})}function u(){window.__extHtmlClass||(window.__extHtmlClass={},c.forEach((t=>p(t))))}const h=(t,e,s,i)=>{let n;e[0]=0;for(let r=1;r<e.length;r++){const o=e[r++],a=e[r]?(e[0]|=o?1:2,s[e[r++]]):e[++r];3===o?i[0]=a:4===o?i[1]=Object.assign(i[1]||{},a):5===o?(i[1]=i[1]||{})[e[++r]]=a:6===o?(++r,"function"==typeof a&&a.$$isState&&(Array.isArray(i[1][e[r]])||(i[1][e[r]]=[i[1][e[r]]],i[1][e[r]].$$hasState=!0)),Array.isArray(i[1][e[r]])?i[1][e[r]].push(a):i[1][e[r]]+=a+""):o?(n=t.apply(a,h(t,a,s,["",null])),i.push(n),a[0]?e[0]|=2:(e[r-2]=0,e[r]=n)):i.push(a)}return i},f=function(t){let e,s,i=1,n="",r="",o=[0];const a=t=>{1===i&&(t||(n=n.replace(/^\s*\n\s*|\s*\n\s*$/g,"")))?o.push(0,t,n):3===i&&(t||n)?(o.push(3,t,n),i=2):2===i&&"..."===n&&t?o.push(4,t,0):2===i&&n&&!t?o.push(5,0,!0,n):i>=5&&((n||!t&&5===i)&&(o.push(i,0,n,s),i=6),t&&(o.push(i,t,0,s),i=6)),n=""};for(let l=0;l<t.length;l++){l&&(1===i&&a(),a(l));for(let c=0;c<t[l].length;c++)e=t[l][c],1===i?"<"===e?(a(),o=[o],i=3):n+=e:4===i?"--"===n&&">"===e?(i=1,n=""):n=e+n[0]:r?e===r?r="":n+=e:'"'===e||"'"===e?r=e:">"===e?(a(),i=1):i&&("="===e?(i=5,s=n,n=""):"/"===e&&(i<5||">"===t[l][c+1])?(a(),3===i&&(o=o[0]),i=o,(o=o[0]).push(2,0,i),i=0):" "===e||"\t"===e||"\n"===e||"\r"===e?(a(),i=2):n+=e),3===i&&"!--"===n&&(i=4,o=o[0])}return a(),o},m=new Map;var d=function(t){let e=m.get(this);return e||(e=new Map,m.set(this,e)),e=h(this,e.get(t)||(e.set(t,e=f(t)),e),arguments,[]),e.length>1?e:e[0]};function b(t){return t.startsWith("on")}function y(t){return t.substring(2)}function $(t,e){let s={};return s[t]=e,s}function g(t,e){t.listeners.push(e)}const x=["gridcolumn","column","templatecolumn","booleancolumn","checkcolumn","datecolumn","numbercolumn","rownumberer","textcolumn","treecolumn"];function A(t,e,s,i){let n=function(t){return{xtype:t.toLowerCase(),listeners:[$("initialize",a),$("destroy",l)]}}(t),r=Object.assign({},e,i);return!function(t){return t.startsWith("html-")}(r.xtype||t)?function(t,e){for(let s in e)if(b(s))g(t,$(y(s),e[s]));else if("controller"===s&&"function"==typeof e[s])t[s]=e[s]();else if("ref"===s&&e[s]&&e[s].$$isRef)t.listeners=t.listeners||[],t.listeners.push($("initialize",(t=>{e[s](t)})));else if("class"===s)t.cls=e[s];else if(Array.isArray(e[s])&&e[s].$$hasState){let i=()=>e[s].map((t=>"function"==typeof t&&t.$$isState?t():t)).join("");t[s]=i(),t.listeners=t.listeners||[],t.listeners.push($("initialize",(t=>{t.$$attributesStateListeners=[],e[s].forEach((e=>{"function"==typeof e&&e.$$isState&&t.$$attributesStateListeners.push(e.$$subscribe((e=>{let n=S(s);"function"==typeof t[n]&&t[S(s)](i())})))}))}))),t.listeners.push($("destroy",(t=>{t.$$attributesStateListeners&&t.$$attributesStateListeners.forEach((t=>t()))})))}else if("function"==typeof e[s]){let i=e[s];i.$$isState&&(t.listeners=t.listeners||[],t.listeners.push($("initialize",(t=>{t.$$stateListener=i.$$subscribe((e=>{let i=S(s);"function"==typeof t[i]&&t[S(s)](e)}))}))),t.listeners.push($("destroy",(t=>{t.$$stateListener&&t.$$stateListener()}))),e[s]=e[s]()),t[s]=e[s]}else t[s]=e[s]}(n,r):n._propsAttributes=e,function(t,e,s){e.forEach((i=>{if(void 0!==i)if(i.xtype&&x.includes(i.xtype))E(t,"columns",i);else if("menu"===i.xtype&&"button"===s)w(t,"menu",i);else if("button"===i.xtype&&x.includes(s))w(t,"cell",{xtype:"widgetcell",forceWidth:!0,widget:{xtype:"container",items:[]}}),E(t.cell.widget,"items",i);else if("button"===i.xtype&&"widgetcell"===s)w(t,"widget",{xtype:"container",items:[]}),E(t.widget,"items",i);else if("widgetcell"===i.xtype)w(t,"cell",i);else if(i.xtype)E(t,"items",i);else if(i.$$isState)E(t,"items",{xtype:"html-x-state",html:String(i()),listeners:[$("initialize",(t=>{t.$$stateListener=i.$$subscribe((e=>{t.bodyElement.el.dom.innerHTML=String(e)}))})),$("destroy",(t=>{t.$$stateListener&&t.$$stateListener()}))]});else{let s=function(t){const e=["string","number","boolean"];if(e.includes(typeof t))return String(t);if("function"==typeof t){const s=t();return e.includes(typeof s)?String(s):""}return console.warn("Unhandled value type:",t),""}(i);!/<[^>]*>/g.test(s)&&(e.length>1||e.some((t=>"function"==typeof t&&!0===t.$$isState)))?E(t,"items",{xtype:"html-x-html",html:s,listeners:[$("initialize",a),$("destroy",l)]}):(t.html=t.html||"",t.html+=s)}}))}(n,s,t),n}function E(t,e,s){t[e]||(t[e]=[]),t[e].push(s)}function w(t,e,s){t[e]||(t[e]=s)}function S(t){return`set${t.charAt(0).toUpperCase()}${t.slice(1)}`}function _(t){return t.startsWith("ext-")?t=t.split("ext-")[1]:t.startsWith("html-")||(t="html-"+t),t}function C(t,e,...s){return"style"===t?{isStyle:!0,content:s}:"context"===t?{isContext:!0,props:e,children:s[0]}:"function"==typeof t?A(_(t.name),t(e),s,e):A(_(t),e,s)}function L(t,...e){let s=d.bind(C)(t,...e);if(s.length>1&&s[0].isStyle){let t=s[0].content;s=s[1],s.stylesheet=t}if(s.isContext){s.props=s.props||{};let t=s.props.name,e=s.stylesheet;s=s.children,s.stylesheet=e,s.contextName=t,s.isContext=!0}return s}const v=new WeakMap;function j(t,e=null,s=!1){if(e)return((t,e)=>(v.has(t)||v.set(t,e()),v.get(t)))(e,(()=>j(t,null,s)));let i=!("object"!=typeof t||null===t||Array.isArray(t)||t instanceof Date||s),n=i?{...t}:t;const r=new Set,o=i?Object.fromEntries(Object.keys(n).map((t=>[t,new Set]))):null,a=t=>(r.add(t),()=>r.delete(t)),l=()=>n;l.$$isState=!0,l.$$subscribe=a;const c=e=>{if(Array.isArray(t))p(n,e)||(n=[...e],r.forEach((t=>t(n))));else if(t instanceof Date)n.getTime()!==e.getTime()&&(n=new Date(e),r.forEach((t=>t(n))));else if(i){let t=!1;const s={...n};Object.keys(e).forEach((i=>{e[i]!==n[i]&&(s[i]=e[i],t=!0,o[i].forEach((t=>t(s[i]))))})),t&&(n=s,r.forEach((t=>t(n))))}else e!==n&&(n=e,r.forEach((t=>t(n))))};i&&Object.keys(n).forEach((t=>{c[t]=e=>{n[t]!==e&&(n={...n,[t]:e},o[t].forEach((e=>e(n[t]))),r.forEach((t=>t(n))))}}));const p=(t,e)=>Array.isArray(t)&&Array.isArray(e)&&t.length===e.length&&t.every(((t,s)=>t===e[s])),u=i?Object.fromEntries(Object.keys(n).map((t=>{const e=()=>n[t];return e.$$isState=!0,e.$$subscribe=e=>(o[t].add(e),()=>o[t].delete(e)),[t,e]}))):l;return[i?u:l,c,a]}try{window&&u()}catch(t){}t.For=function({each:t,effect:e}){return L`<ext-container oninitialize="${function(s){const i=new Map,n=t=>{const n=new Map;for(t.forEach(((t,r)=>{const o=i.get(r)||{};n.set(r,o);const a=e(t,r,o);s.items.getAt(r)?(s.removeAt(r),s.insert(r,a)):s.add(a)}));s.items.length>t.length;)s.removeAt(s.items.length-1);i.clear();for(const[t,e]of n.entries())i.set(t,e)};Array.isArray(t)?n(t):(n(t()),t.$$isState&&t.$$subscribe(n))}}"></ext-container>`},t.createDerivedState=function(t,e,...s){const[i,n]=j(e(t(),...s));return t.$$subscribe((t=>{n(e(t,...s))})),i},t.createEffect=function(t,e,s=!1){if("function"!=typeof t)throw new Error("Effect must be a function");if(!Array.isArray(e))throw new Error("Dependencies must be an array");s&&t();const i=e.map((e=>{if(e&&"function"==typeof e.$$subscribe)return e.$$subscribe((()=>t()));throw new Error("Dependencies must be objects with the method $$subscribe")}));return()=>{i.forEach((t=>{"function"==typeof t&&t()}))}},t.createPropertyObserver=function(t,e,s=null){if("object"!=typeof t||null===t)throw new Error("Target must be an object");const i=e.split(".");let n=t;for(let t=0;t<i.length-1;t++)if(n=n[i[t]],"object"!=typeof n||null===n)throw new Error(`Invalid property path: ${e}`);const r=i[i.length-1],o=[];let a=n[r];return Object.defineProperty(n,r,{get:()=>a,set(t){const e=a;a=t,o.forEach((s=>s(t,e))),s&&s(t,e)},configurable:!0,enumerable:!0}),{$$subscribe:t=>(o.push(t),()=>{const e=o.indexOf(t);-1!==e&&o.splice(e,1)})}},t.createRef=function(t){let e=null;const s=[],i=function(i){if(0===arguments.length)return e;e!==i&&(e=i,"function"==typeof t&&t(i),s.forEach((t=>t(i))))};return i.$$isRef=!0,i.$$subscribe=function(t){if("function"==typeof t)return s.push(t),()=>{const e=s.indexOf(t);-1!==e&&s.splice(e,1)};throw new Error("Listener must be a function")},i},t.createState=j,t.defineExtClass=p,t.destroy=l,t.generateHtmlClass=u,t.h=L,t.initialize=a}));
